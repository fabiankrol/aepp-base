{"version":3,"sources":["webpack:///./src/pages/mobile/RedeemBalance.vue?6ffe","webpack:///./src/pages/mobile/RedeemBalance.vue?0c58","webpack:///./src/pages/mobile/RedeemBalance.vue","webpack:///./src/pages/mobile/RedeemBalance.vue?ea11","webpack:///src/pages/mobile/RedeemBalance.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","name","$t","slot","_v","_s","balance","_l","account","_b","key","address","on","$event","sendToAccount","staticRenderFns","component","components","AeSpinner","Page","Guide","Balance","ListItemAccount","LeftMore","data","subscriptions","methods"],"mappings":"sHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAQF,EAAQ,KAAEI,EAAG,MAAM,CAACE,YAAY,WAAW,CAACF,EAAG,cAAc,GAAGA,EAAG,OAAO,CAACE,YAAY,iBAAiBC,MAAM,CAAC,cAAc,UAAU,kBAAkB,CAAEC,KAAM,YAAa,yBAAyB,UAAU,CAACJ,EAAG,QAAQ,CAACG,MAAM,CAAC,KAAO,SAAS,SAAWP,EAAIS,GAAG,kCAAkCC,KAAK,WAAWN,EAAG,MAAM,CAACE,YAAY,eAAe,CAACF,EAAG,OAAO,CAACJ,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIS,GAAG,oCAAoCL,EAAG,UAAU,CAACG,MAAM,CAAC,QAAUP,EAAIa,YAAY,GAAGb,EAAIc,GAAId,EAAY,UAAE,SAASe,GAAS,OAAOX,EAAG,kBAAkBJ,EAAIgB,GAAG,CAACC,IAAIF,EAAQG,QAAQX,MAAM,CAAC,cAAc,IAAIY,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOpB,EAAIqB,cAAcN,EAAQG,YAAY,kBAAkBH,GAAQ,GAAO,CAACX,EAAG,WAAW,CAACG,MAAM,CAAC,KAAO,SAASG,KAAK,WAAW,OAAM,IACn1BY,EAAkB,G,YCDgV,S,wBCQlWC,EAAY,eACd,EACAxB,EACAuB,GACA,EACA,KACA,WACA,MAIa,aAAAC,E,kECnBf,W,+QCoDA,QACEC,WAAY,CACVC,UAAJ,OACIC,KAAJ,OACIC,MAAJ,OACIC,QAAJ,OACIC,gBAAJ,OACIC,SAAJ,KAEEC,KAAM,WAAR,OACA,aACA,UACA,UAEEC,cAdF,WAeI,OAAO,OAAX,OAAW,CAAX,6CAEE,QAjBF,WAiBA,mKACA,UADA,0CAGA,eAHA,iEAKA,kCACA,yDANA,kDAUA,UAVA,4DAYEC,QAAS,CACP,WADJ,WACA,wLAEA,iCACA,kBACA,6CAJA,OAEA,EAFA,OAOA,IACA,kBACA,SACA,kBACA,aAXA,GAcA,cAdA,gCAeA,iCACA,aACA,qDAjBA,+CAsBA,uFAtBA,KAuBA,IAvBA,UAuBA,iCAvBA,uBAuBA,WAvBA,cAwBA,qBACA,kBAzBA,kCA0BA,iCACA,aACA,gDA5BA,0CAiCA,mCAjCA,+CAmCI,cApCJ,SAoCA,oLACA,UADA,SAGA,uBACA,SACA,mFACA,gEAHA,CAKA,6BARA,8BAUA,mBAVA,gBAEA,EAFA,EAEA,OAFA,EAEA,UASA,kCACA,iCACA,oBACA,kBACA,mCAfA,mD","file":"js/page-redeem.0cd037ca.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.busy)?_c('div',{staticClass:\"spinner\"},[_c('AeSpinner')],1):_c('Page',{staticClass:\"redeem-balance\",attrs:{\"header-fill\":\"neutral\",\"right-button-to\":{ name: 'transfer' },\"right-button-icon-name\":\"close\"}},[_c('Guide',{attrs:{\"slot\":\"header\",\"template\":_vm.$t('transfer.redeem-balance.guide')},slot:\"header\"}),_c('div',{staticClass:\"balance-row\"},[_c('span',[_vm._v(_vm._s(_vm.$t('transfer.send.amount.balance')))]),_c('Balance',{attrs:{\"balance\":_vm.balance}})],1),_vm._l((_vm.accounts),function(account){return _c('ListItemAccount',_vm._b({key:account.address,attrs:{\"border-dark\":\"\"},on:{\"click\":function($event){return _vm.sendToAccount(account.address)}}},'ListItemAccount',account,false),[_c('LeftMore',{attrs:{\"slot\":\"right\"},slot:\"right\"})],1)})],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RedeemBalance.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RedeemBalance.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RedeemBalance.vue?vue&type=template&id=15cb73e8&scoped=true&\"\nimport script from \"./RedeemBalance.vue?vue&type=script&lang=js&\"\nexport * from \"./RedeemBalance.vue?vue&type=script&lang=js&\"\nimport style0 from \"./RedeemBalance.vue?vue&type=style&index=0&id=15cb73e8&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"15cb73e8\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RedeemBalance.vue?vue&type=style&index=0&id=15cb73e8&lang=scss&scoped=true&\"","<template>\n  <div\n    v-if=\"busy\"\n    class=\"spinner\"\n  >\n    <AeSpinner />\n  </div>\n  <Page\n    v-else\n    header-fill=\"neutral\"\n    :right-button-to=\"{ name: 'transfer' }\"\n    right-button-icon-name=\"close\"\n    class=\"redeem-balance\"\n  >\n    <Guide\n      slot=\"header\"\n      :template=\"$t('transfer.redeem-balance.guide')\"\n    />\n\n    <div class=\"balance-row\">\n      <span>{{ $t('transfer.send.amount.balance') }}</span>\n      <Balance :balance=\"balance\" />\n    </div>\n\n    <ListItemAccount\n      v-for=\"account in accounts\"\n      :key=\"account.address\"\n      border-dark\n      v-bind=\"account\"\n      @click=\"sendToAccount(account.address)\"\n    >\n      <LeftMore slot=\"right\" />\n    </ListItemAccount>\n  </Page>\n</template>\n\n<script>\nimport { pick } from 'lodash-es';\nimport BigNumber from 'bignumber.js';\nimport {\n  Ae, Transaction, Crypto, TxBuilderHelper,\n} from '@aeternity/aepp-sdk';\nimport { handleUnknownError } from '../../lib/utils';\nimport AeSpinner from '../../components/AeSpinner.vue';\nimport Page from '../../components/Page.vue';\nimport Guide from '../../components/Guide.vue';\nimport Balance from '../../components/Balance.vue';\nimport ListItemAccount from '../../components/ListItemAccount.vue';\nimport { LeftMore } from '../../components/icons';\nimport { MAGNITUDE } from '../../lib/constants';\nimport { MIN_SPEND_TX_FEE } from '../../lib/spendTxFees';\n\nexport default {\n  components: {\n    AeSpinner,\n    Page,\n    Guide,\n    Balance,\n    ListItemAccount,\n    LeftMore,\n  },\n  data: () => ({\n    keypair: null,\n    balance: 0,\n    busy: true,\n  }),\n  subscriptions() {\n    return pick(this.$store.state.observables, ['accounts']);\n  },\n  async mounted() {\n    while (!this.keypair) {\n      try {\n        await this.readQrCode(); // eslint-disable-line no-await-in-loop\n      } catch (error) {\n        this.$router.push({ name: 'transfer' });\n        if (error.message !== 'Cancelled by user') handleUnknownError(error);\n        return;\n      }\n    }\n    this.busy = false;\n  },\n  methods: {\n    async readQrCode() {\n      let privateKey;\n      privateKey = await this.$store.dispatch('modals/open', {\n        name: 'readQrCode',\n        title: this.$t('transfer.redeem-balance.scan'),\n      });\n\n      try {\n        privateKey = Buffer.from(privateKey, 'hex');\n      } catch (error) {\n        handleUnknownError(error);\n        privateKey = Buffer.from([]);\n      }\n\n      if (privateKey.length !== 64) {\n        await this.$store.dispatch('modals/open', {\n          name: 'alert',\n          text: this.$t('transfer.redeem-balance.wrong-qr-code'),\n        });\n        return;\n      }\n\n      const address = TxBuilderHelper.encode(Crypto.generateKeyPairFromSecret(privateKey).publicKey, 'ak');\n      this.balance = BigNumber(await this.$store.state.sdk.getBalance(address))\n        .shiftedBy(-MAGNITUDE);\n      if (this.balance < MIN_SPEND_TX_FEE) {\n        await this.$store.dispatch('modals/open', {\n          name: 'alert',\n          text: this.$t('transfer.redeem-balance.no-funds'),\n        });\n        return;\n      }\n\n      this.keypair = { address, privateKey };\n    },\n    async sendToAccount(accountTo) {\n      this.busy = true;\n      const { hash, tx: { amount } } = await (\n        await Ae.compose(Transaction, {\n          methods: {\n            sign: (data) => Promise.resolve(Crypto.sign(data, this.keypair.privateKey)),\n            address: () => Promise.resolve(this.keypair.address),\n          },\n        })({ url: this.$store.state.sdkUrl })\n      )\n        .transferFunds(1, accountTo);\n      this.$router.push({ name: 'transfer' });\n      this.$store.dispatch('modals/open', {\n        name: 'spendSuccess',\n        transactionHash: hash,\n        amount: BigNumber(amount).shiftedBy(-MAGNITUDE),\n      });\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import '../../styles/typography';\n\n.spinner {\n  flex-grow: 1;\n  display: flex;\n\n  .ae-spinner {\n    margin: auto;\n  }\n}\n\n.redeem-balance .balance-row {\n  display: flex;\n  justify-content: space-between;\n  @extend %face-sans-base;\n}\n</style>\n"],"sourceRoot":""}